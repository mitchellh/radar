<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Class: Radar::Reporter::FileReporter</title>
<link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (F)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../../Radar.html" title="Radar (module)">Radar</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Reporter.html" title="Radar::Reporter (class)">Reporter</a></span></span>
     &raquo; 
    <span class="title">FileReporter</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Radar::Reporter::FileReporter
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Radar::Reporter::FileReporter</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/radar/reporter/file_reporter.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>Reports exceptions by dumping the JSON data out to a file on the
local filesystem. The reporter is configurable:</p>

<h2>Configurable Values</h2>

<h3><code>output_directory</code></h3>

<p>Specifies the directory where the outputted files are stored. This value
can be either a string or a lambda which takes an <span class='object_link'><a href="../ExceptionEvent.html" title="Radar::ExceptionEvent (class)">ExceptionEvent</a></span> as its
only parameter. The reporter will automatically attempt to make the configured
directory if it doesn't already exist. Examples of both methods of specifying
the directory are shown below:</p>

<pre class="code"><span class='id reporter'>reporter</span><span class='period'>.</span><span class='id output_directory'>output_directory</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>~/hard/coded/path</span><span class='tstring_end'>&quot;</span></span>
</pre>

<p>Or:</p>

<pre class="code"><span class='id reporter'>reporter</span><span class='period'>.</span><span class='id output_directory'>output_directory</span> <span class='op'>=</span> <span class='id lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id event'>event</span><span class='op'>|</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>~/.radar/errors/</span><span class='embexpr_beg'>#{</span><span class='id event'>event</span><span class='period'>.</span><span class='id application'>application</span><span class='period'>.</span><span class='id name'>name</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
</pre>

<h3><code>prune_time</code></h3>

<p>Specifies the maximum age (in seconds) that a previously outputted file
is allowed to reach before being pruned. When an exception is raised, the
FileReporter will automatically prune existing files which are older than
the specified amount. By default this is <code>nil</code> (no pruning occurs).</p>

<pre class="code"><span class='comment'># One week:
</span><span class='id reporter'>reporter</span><span class='period'>.</span><span class='id prune_time'>prune_time</span> <span class='op'>=</span> <span class='int'>60</span> <span class='op'>*</span> <span class='int'>60</span> <span class='op'>*</span> <span class='int'>24</span> <span class='op'>*</span> <span class='int'>7</span>
</pre>

  </div>
</div>
<div class="tags">
  
</div>

  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#output_directory-instance_method" title="#output_directory (instance method)">- (Object) <strong>output_directory</strong>(event = nil) </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns the currently configured output directory.</p></div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#prune_time-instance_method" title="#prune_time (instance method)">- (Object) <strong>prune_time</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns the value of attribute prune_time.</p></div></span>
  
</li>

    
  </ul>


  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (FileReporter) <strong>initialize</strong>(opts = nil) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>A new instance of FileReporter.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#log-instance_method" title="#log (instance method)">- (Object) <strong>log</strong>(message) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Convenience method for logging.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#prune-instance_method" title="#prune (instance method)">- (Object) <strong>prune</strong>(directory) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Prunes the files in the given directory according to the age limit
set by the <span class='object_link'><a href="#prune_time-instance_method" title="Radar::Reporter::FileReporter#prune_time (method)">FileReporter#prune_time</a></span> variable.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#report-instance_method" title="#report (instance method)">- (Object) <strong>report</strong>(event) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Radar::Reporter::FileReporter (class)">FileReporter</a></span></tt>) <strong>initialize</strong>(opts = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>A new instance of FileReporter</p>

  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


38
39
40
41
42
43
44</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/radar/reporter/file_reporter.rb', line 38</span>

<span class='kw'>def</span> <span class='id initialize'>initialize</span><span class='lparen'>(</span><span class='id opts'>opts</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='lparen'>(</span><span class='id opts'>opts</span> <span class='op'>||</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id k'>k</span><span class='comma'>,</span><span class='id v'>v</span><span class='op'>|</span>
    <span class='id send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id k'>k</span><span class='rbrace'>}</span><span class='tstring_content'>=</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id v'>v</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='ivar'>@output_directory</span> <span class='op'>||=</span> <span class='id lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id event'>event</span><span class='op'>|</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>~/.radar/errors/</span><span class='embexpr_beg'>#{</span><span class='id event'>event</span><span class='period'>.</span><span class='id application'>application</span><span class='period'>.</span><span class='id name'>name</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="output_directory=-instance_method"></span>
      <span id="output_directory-instance_method"></span>
      <div class="method_details first">
  <p class="signature first" id="output_directory-instance_method">
  
    - (<tt>Object</tt>) <strong>output_directory</strong>(event = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Returns the currently configured output directory. If <code>event</code> is given
as a parameter and the currently set directory is a lambda, then the
lambda will be evaluated then returned. If no event is given, the lambda
is returned as-is.</p>

  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


92
93
94
95</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/radar/reporter/file_reporter.rb', line 92</span>

<span class='kw'>def</span> <span class='id output_directory'>output_directory</span><span class='lparen'>(</span><span class='id event'>event</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='ivar'>@output_directory</span><span class='period'>.</span><span class='id call'>call</span><span class='lparen'>(</span><span class='id event'>event</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id event'>event</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@output_directory</span><span class='period'>.</span><span class='id is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Proc</span><span class='rparen'>)</span>
  <span class='ivar'>@output_directory</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="prune_time=-instance_method"></span>
      <span id="prune_time-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="prune_time-instance_method">
  
    - (<tt>Object</tt>) <strong>prune_time</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Returns the value of attribute prune_time</p>

  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


36
37
38</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/radar/reporter/file_reporter.rb', line 36</span>

<span class='kw'>def</span> <span class='id prune_time'>prune_time</span>
  <span class='ivar'>@prune_time</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="log-instance_method">
  
    - (<tt>Object</tt>) <strong>log</strong>(message) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Convenience method for logging.</p>

  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


84
85
86</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/radar/reporter/file_reporter.rb', line 84</span>

<span class='kw'>def</span> <span class='id log'>log</span><span class='lparen'>(</span><span class='id message'>message</span><span class='rparen'>)</span>
  <span class='ivar'>@event</span><span class='period'>.</span><span class='id application'>application</span><span class='period'>.</span><span class='id logger'>logger</span><span class='period'>.</span><span class='id info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id class'>class</span><span class='rbrace'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id message'>message</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='ivar'>@event</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="prune-instance_method">
  
    - (<tt>Object</tt>) <strong>prune</strong>(directory) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Prunes the files in the given directory according to the age limit
set by the <span class='object_link'><a href="#prune_time-instance_method" title="Radar::Reporter::FileReporter#prune_time (method)">#prune_time</a></span> variable.</p>

  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>directory</span>
      
      
      
        &mdash;
        <div class='inline'><p>Directory to prune</p></div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


72
73
74
75
76
77
78
79
80
81</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/radar/reporter/file_reporter.rb', line 72</span>

<span class='kw'>def</span> <span class='id prune'>prune</span><span class='lparen'>(</span><span class='id directory'>directory</span><span class='rparen'>)</span>
  <span class='id count'>count</span> <span class='op'>=</span> <span class='const'>Dir</span><span class='lbracket'>[</span><span class='const'>File</span><span class='period'>.</span><span class='id join'>join</span><span class='lparen'>(</span><span class='id directory'>directory</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>*.txt</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id inject'>inject</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id acc'>acc</span><span class='comma'>,</span> <span class='id file'>file</span><span class='op'>|</span>
    <span class='kw'>next</span> <span class='id acc'>acc</span> <span class='kw'>unless</span> <span class='const'>File</span><span class='period'>.</span><span class='id file?'>file?</span><span class='lparen'>(</span><span class='id file'>file</span><span class='rparen'>)</span>
    <span class='kw'>next</span> <span class='id acc'>acc</span> <span class='kw'>unless</span> <span class='lparen'>(</span><span class='const'>Time</span><span class='period'>.</span><span class='id now'>now</span><span class='period'>.</span><span class='id to_i'>to_i</span> <span class='op'>-</span> <span class='const'>File</span><span class='period'>.</span><span class='id ctime'>ctime</span><span class='lparen'>(</span><span class='id file'>file</span><span class='rparen'>)</span><span class='period'>.</span><span class='id to_i'>to_i</span><span class='rparen'>)</span> <span class='op'>&gt;=</span> <span class='id prune_time'>prune_time</span><span class='period'>.</span><span class='id to_i'>to_i</span>
    <span class='const'>File</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='id file'>file</span><span class='rparen'>)</span>
    <span class='id acc'>acc</span> <span class='op'>+</span> <span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='id log'>log</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Pruned </span><span class='embexpr_beg'>#{</span><span class='id count'>count</span><span class='rbrace'>}</span><span class='tstring_content'> file(s) in </span><span class='embexpr_beg'>#{</span><span class='id directory'>directory</span><span class='rbrace'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id count'>count</span> <span class='op'>&gt;</span> <span class='int'>0</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="report-instance_method">
  
    - (<tt>Object</tt>) <strong>report</strong>(event) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/radar/reporter/file_reporter.rb', line 46</span>

<span class='kw'>def</span> <span class='id report'>report</span><span class='lparen'>(</span><span class='id event'>event</span><span class='rparen'>)</span>
  <span class='ivar'>@event</span> <span class='op'>=</span> <span class='id event'>event</span>
  <span class='id output_file'>output_file</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id join'>join</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id expand_path'>expand_path</span><span class='lparen'>(</span><span class='id output_directory'>output_directory</span><span class='lparen'>(</span><span class='id event'>event</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id event'>event</span><span class='period'>.</span><span class='id occurred_at'>occurred_at</span><span class='period'>.</span><span class='id to_i'>to_i</span><span class='rbrace'>}</span><span class='tstring_content'>-</span><span class='embexpr_beg'>#{</span><span class='id event'>event</span><span class='period'>.</span><span class='id uniqueness_hash'>uniqueness_hash</span><span class='rbrace'>}</span><span class='tstring_content'>.txt</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id directory'>directory</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id dirname'>dirname</span><span class='lparen'>(</span><span class='id output_file'>output_file</span><span class='rparen'>)</span>

  <span class='kw'>begin</span>
    <span class='comment'># Attempt to make the directory if it doesn't exist
</span>    <span class='const'>FileUtils</span><span class='period'>.</span><span class='id mkdir_p'>mkdir_p</span><span class='lparen'>(</span><span class='id directory'>directory</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='op'>!</span><span class='const'>File</span><span class='period'>.</span><span class='id directory?'>directory?</span><span class='lparen'>(</span><span class='id directory'>directory</span><span class='rparen'>)</span>

    <span class='comment'># Prune files if enabled
</span>    <span class='id prune'>prune</span><span class='lparen'>(</span><span class='id directory'>directory</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id prune_time'>prune_time</span>

    <span class='comment'># Write out the JSON to the output file
</span>    <span class='id log'>log</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id class'>class</span><span class='rbrace'>}</span><span class='tstring_content'>: Reported to </span><span class='embexpr_beg'>#{</span><span class='id output_file'>output_file</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='const'>File</span><span class='period'>.</span><span class='id open'>open</span><span class='lparen'>(</span><span class='id output_file'>output_file</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>w</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id f'>f</span><span class='op'>|</span> <span class='id f'>f</span><span class='period'>.</span><span class='id write'>write</span><span class='lparen'>(</span><span class='id event'>event</span><span class='period'>.</span><span class='id to_json'>to_json</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EACCES</span>
    <span class='comment'># Rebrand the exception so its easier to tell what exactly
</span>    <span class='comment'># is going on.
</span>    <span class='id raise'>raise</span> <span class='const'>ReporterError</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id class'>class</span><span class='rbrace'>}</span><span class='tstring_content'>: Failed to create directory or log to: </span><span class='embexpr_beg'>#{</span><span class='id output_file'>output_file</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Tue Oct  5 13:56:08 2010 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.1 (ruby-1.9.2).
</div>

  </body>
</html>